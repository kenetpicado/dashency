import{b as D,r as b,bO as $,o as j,y as B,e as l,i as t,l as y,f as _,h as x,F as p,g as k,m as h,T as S,p as E,t as F,z as N,j as r,x as n,q as C}from"./index-BSHwk9V5.js";import{_ as Y}from"./InputForm.vue_vue_type_script_setup_true_lang-BUOOodyS.js";import{u as L}from"./useArching-C1-o2794.js";import{u as O}from"./useBilling-DDDwZkeH.js";/* empty css              */import"./query-params-C5SC1Cld.js";const P=t("header",{class:"flex items-center justify-between mb-4 h-14"},[t("span",{class:"font-bold text-2xl"},"Nuevo Arqueo")],-1),z={class:"grid grid-cols-4 gap-4 mb-4"},G={class:"grid grid-cols-2 gap-4"},I={class:"flex flex-col gap-4"},R=t("div",{class:"font-bold text-xl"},"Transacciones",-1),U={key:0,class:"text-center text-gray-400"},H={class:"text-gray-400 text-xs mb-2"},J={class:"mb-1"},K={class:"flex justify-between"},Q={class:"text-xl"},W={class:"flex flex-col gap-4"},X=t("div",{class:"font-bold text-xl"},"Resumen",-1),Z=t("th",null,"Tipo",-1),tt=t("th",null,"Cantidad",-1),et=t("th",null,"Peso",-1),at=t("th",null,"Total",-1),st={key:0},nt=t("td",{colspan:"6",class:"text-center"},"No hay datos que mostrar",-1),ot=[nt],lt=t("th",null,"Banco",-1),rt=t("th",null,"Cantidad",-1),ut=t("th",null,"Total",-1),dt={key:0},ct=t("td",{colspan:"6",class:"text-center"},"No hay datos que mostrar",-1),it=[ct],_t={class:"flex justify-end gap-4"},bt=D({__name:"ArchingCreate",setup(ht){const{getBillingDay:T,queryParams:m,billing:d}=O(),{processing:M,storeArching:A}=L(),f=b([]),v=b([]),i=b({date:"",total:0,summary:[],summaryBanks:[],billing_ids:[]});$(()=>m.value.date,async()=>{await T(),w(),q()}),j(async()=>{m.value.date=B(new Date,"YYYY-MM-DD"),await T(),w(),q()});function w(){const c=new Set(d.value.data.map(e=>e.bank)),s=[];c.forEach(e=>{const a=d.value.data.filter(u=>u.bank===e);s.push({bank:e,total:Math.round(a.reduce((u,o)=>u+o.total,0)*100)/100,references:a.map(u=>u.reference)})}),s.push({bank:"TOTAL",total:Math.round(s.reduce((e,a)=>e+a.total,0)*100)/100,references:d.value.data.map(e=>e.reference)}),f.value=s}function q(){const c=d.value.data.filter(a=>a.summary!==void 0&&a.summary.length>1).map(a=>a.summary).flat(),s=[];[...new Set(c.map(a=>a.type))].sort().forEach(a=>{const u=c.filter(o=>o&&o.type===a);s.push({type:a,weight:Math.round(u.reduce((o,g)=>o+g.weight,0)*100)/100,amount:Math.round(u.reduce((o,g)=>o+g.amount,0)*100)/100,count:Math.round(u.reduce((o,g)=>o+g.count,0))})}),v.value=s}function V(){d.value.data.length||N.error("No hay transacciones que guardar"),i.value.date=m.value.date,i.value.summary=v.value,i.value.summaryBanks=f.value,i.value.billing_ids=d.value.data.map(s=>s.id);const c=f.value.find(s=>s.bank==="TOTAL");c&&(i.value.total=c.total),i.value.total<1&&N.error("El total es requerido"),A(i.value)}return(c,s)=>(r(),l(p,null,[P,t("div",z,[y(Y,{text:"Fecha",name:"date",modelValue:_(m).date,"onUpdate:modelValue":s[0]||(s[0]=e=>_(m).date=e),type:"date"},null,8,["modelValue"])]),t("div",G,[t("div",I,[R,_(d).data.length?x("",!0):(r(),l("div",U,"No hay transacciones")),(r(!0),l(p,null,k(_(d).data,e=>(r(),l("div",{key:e.id,class:"bg-white p-4 rounded-lg border"},[t("div",H,n(_(B)(e.createdAt)),1),t("div",J,n(e.client),1),t("div",K,[t("div",null,n(e.bank)+": "+n(e.reference),1),t("div",Q,"$"+n(e.total),1)])]))),128))]),t("div",W,[X,y(S,null,{header:h(()=>[Z,tt,et,at]),body:h(()=>[v.value.length?x("",!0):(r(),l("tr",st,ot)),(r(!0),l(p,null,k(v.value,(e,a)=>(r(),l("tr",{key:a,class:"hover:bg-gray-50"},[t("td",null,n(e.type),1),t("td",null,n(e.count),1),t("td",null,n(e.weight)+" lbs",1),t("td",null,"$"+n(e.amount),1)]))),128))]),_:1}),y(S,null,{header:h(()=>[lt,rt,ut]),body:h(()=>[f.value.length?x("",!0):(r(),l("tr",dt,it)),(r(!0),l(p,null,k(f.value,(e,a)=>(r(),l("tr",{key:a,class:"hover:bg-gray-50"},[t("td",null,n(e.bank),1),t("td",null,n(e.references.length),1),t("td",null,"$"+n(e.total),1)]))),128))]),_:1}),t("div",_t,[y(E,null,{default:h(()=>[C("Cancelar")]),_:1}),y(F,{onClick:V,loading:_(M)},{default:h(()=>[C(" Guardar ")]),_:1},8,["loading"])])])])],64))}});export{bt as default};
