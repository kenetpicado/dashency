import{A as X,b as Y,r as x,E as Z,o as ee,e as i,l as s,f as r,J as w,i as a,m as g,t as U,F as f,g as V,h as $,T as te,n as ae,p as le,z as _,j as o,q as S,k as A,x as y}from"./index-yVOrI8SX.js";import{_ as b}from"./InputForm.vue_vue_type_script_setup_true_lang-CXVeik5b.js";import{L as E}from"./index-C59muutI.js";/* empty css              */import{u as oe}from"./usePackage-uGyj3CPj.js";import{_ as R}from"./PackageCard.vue_vue_type_script_setup_true_lang-5QxceEP3.js";import{u as ne}from"./useBilling-Byt5YPte.js";import{b as se}from"./banks-0GAEnnM3.js";import"./_commonjsHelpers-BosuxZz1.js";import"./query-params-C5SC1Cld.js";/**
 * @license @tabler/icons-vue v3.12.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var re=X("outline","trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]);const ue=a("header",{class:"flex items-center justify-between mb-4 h-14"},[a("span",{class:"font-bold text-2xl"},"Nueva")],-1),ie={class:"grid grid-cols-2 gap-4"},de=a("div",{class:"text-lg mb-2 font-bold"},"Buscar paquetes",-1),ce={class:"grid grid-cols-2 gap-4 items-end"},me={key:0,class:"text-center text-gray-400 mt-5"},ve={key:1,class:"grid grid-cols-1 xl:grid-cols-2 gap-4"},ge=a("div",{class:"text-lg mb-2 font-bold"},"Factura",-1),pe={key:0,class:"text-center text-gray-400"},he={class:"grid grid-cols-1 xl:grid-cols-2 gap-4 mb-8"},fe=a("th",null,"Tipo",-1),_e=a("th",null,"Peso total",-1),ye=a("th",null,"Paquetes",-1),be=a("th",null,"Total a pagar",-1),ke={key:0},xe=a("td",{colspan:"4",class:"text-center"},"No hay datos que mostrar",-1),Ve=[xe],Te={class:"grid grid-cols-2 gap-4"},Me=a("option",{value:""},"Seleccionar banco",-1),Pe=["value"],Se=a("div",{class:"text-sm text-red-400 mb-4"}," Por favor, verifique los datos antes de guardar la factura ya que no se podrán modificar posteriormente. ",-1),qe={class:"flex justify-end gap-4"},Le=Y({__name:"BillingCreate",setup(Ie){const n=x([]),{getPackages:D,packages:q,queryParams:m,processing:T}=oe(),{storeBilling:L,processing:p}=ne(),O=[{type:"AEREO",value:7},{type:"MARITIMO",value:3}],k=x([]),l=x({client:"",packages_ids:[],total:0,reference:"",bank:"",summary:[]});function W(u){n.value.push(u),n.value.length===1&&(l.value.client=u.client),N()}function j(u){n.value.splice(u,1),n.value.length||(l.value.client=""),N()}const I=Z(()=>q.value.data.filter(u=>!n.value.find(t=>t.id===u.id)));function F(){if(!l.value.client){_.error("Debe ingresar el nombre del cliente");return}if(!n.value.length){_.error("Debe seleccionar al menos un paquete");return}if(!l.value.reference){_.error("Ingrese una referencia");return}if(!l.value.bank){_.error("Seleccione un banco");return}l.value.summary=k.value,l.value.packages_ids=n.value.map(u=>u.id),L(l.value)}function N(){const u=new Set(n.value.map(d=>d.type)),t=x([]);u.forEach(d=>{var C;const v=((C=O.find(h=>h.type===d))==null?void 0:C.value)||0,B=n.value.filter(h=>h.type===d),z=B.reduce((h,Q)=>h+Q.grossWeight,0),P=Math.round(z*100)/100,J=P<1?v:v*P,H=Math.round(J*100)/100,K={type:d,weight:P,count:B.length,amount:H};t.value.push(K)});const e=t.value.reduce((d,v)=>d+v.weight,0),c=t.value.reduce((d,v)=>d+v.amount,0),M={type:"TOTAL",weight:Math.round(e*100)/100,count:n.value.length,amount:Math.round(c*100)/100};t.value.push(M),l.value.total=M.amount,k.value=t.value}function G(){if(!m.value.guide&&!m.value.client){_.error("Debe ingresar al menos un criterio de búsqueda");return}m.value.status="REGISTRADO",D()}return ee(()=>{q.value.data=[]}),(u,t)=>(o(),i(f,null,[s(r(E),{active:r(p),"onUpdate:active":t[0]||(t[0]=e=>w(p)?p.value=e:null),color:"#2563eb",loader:"dots"},null,8,["active"]),s(r(E),{active:r(T),"onUpdate:active":t[1]||(t[1]=e=>w(T)?T.value=e:null),color:"#2563eb",loader:"dots"},null,8,["active"]),ue,a("div",ie,[a("div",null,[de,s(b,{text:"Cliente",name:"search",modelValue:r(m).client,"onUpdate:modelValue":t[2]||(t[2]=e=>r(m).client=e),placeholder:"Nombre del cliente"},null,8,["modelValue"]),a("div",ce,[s(b,{text:"Guía",name:"search",modelValue:r(m).guide,"onUpdate:modelValue":t[3]||(t[3]=e=>r(m).guide=e),placeholder:"Número de guía"},null,8,["modelValue"]),s(U,{class:"mb-5",onClick:G,loading:r(p)},{default:g(()=>[S(" Buscar ")]),_:1},8,["loading"])]),I.value.length?(o(),i("div",ve,[(o(!0),i(f,null,V(I.value,(e,c)=>(o(),A(R,{item:e,key:c,showIcon:!0,onSelectedItem:W},null,8,["item"]))),128))])):(o(),i("div",me," No hay datos que mostrar "))]),a("div",null,[ge,s(b,{text:"Cliente",name:"client",modelValue:l.value.client,"onUpdate:modelValue":t[4]||(t[4]=e=>l.value.client=e),placeholder:"Nombre del cliente"},null,8,["modelValue"]),n.value.length?$("",!0):(o(),i("div",pe," No hay paquetes seleccionados ")),a("div",he,[(o(!0),i(f,null,V(n.value,(e,c)=>(o(),A(R,{item:e,key:c,showIcon:!0,icon:r(re),onSelectedItem:M=>j(c)},null,8,["item","icon","onSelectedItem"]))),128))]),s(te,{class:"mb-4"},{header:g(()=>[fe,_e,ye,be]),body:g(()=>[k.value.length==0?(o(),i("tr",ke,Ve)):$("",!0),(o(!0),i(f,null,V(k.value,(e,c)=>(o(),i("tr",{key:c},[a("td",null,y(e.type),1),a("td",null,y(e.weight)+" lbs",1),a("td",null,y(e.count),1),a("td",null,"$"+y(e.amount),1)]))),128))]),_:1}),s(b,{text:"Total pagado",name:"total",modelValue:l.value.total,"onUpdate:modelValue":t[5]||(t[5]=e=>l.value.total=e),modelModifiers:{number:!0}},null,8,["modelValue"]),a("div",Te,[s(b,{text:"Referencia",name:"reference",type:"number",modelValue:l.value.reference,"onUpdate:modelValue":t[6]||(t[6]=e=>l.value.reference=e)},null,8,["modelValue"]),s(ae,{text:"Banco",name:"bank",modelValue:l.value.bank,"onUpdate:modelValue":t[7]||(t[7]=e=>l.value.bank=e)},{default:g(()=>[Me,(o(!0),i(f,null,V(r(se),e=>(o(),i("option",{value:e,key:e},y(e),9,Pe))),128))]),_:1},8,["modelValue"])]),Se,a("div",qe,[s(le,null,{default:g(()=>[S("Cancelar")]),_:1}),s(U,{onClick:F,loading:r(p)},{default:g(()=>[S(" Guardar ")]),_:1},8,["loading"])])])])],64))}});export{Le as default};
