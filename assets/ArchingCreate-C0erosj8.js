import{b as D,r as b,K as $,o as j,j as q,e as n,i as t,m as g,f as _,h as p,F as x,g as k,n as h,T as N,q as E,x as F,z as A,k as l,t as o,v as C}from"./index-ikaeWfkH.js";import{_ as Y}from"./InputForm.vue_vue_type_script_setup_true_lang-C3toEXwb.js";import{u as L}from"./useArching-BxpAfyHP.js";import{u as P}from"./useBilling-BtSCfeWI.js";/* empty css              */import"./query-params-C5SC1Cld.js";const O=t("header",{class:"flex items-center justify-between mb-4 h-14"},[t("span",{class:"font-bold text-2xl"},"Nuevo Arqueo")],-1),z={class:"grid grid-cols-4 gap-4 mb-4"},G={class:"grid grid-cols-2 gap-4"},I={class:"flex flex-col gap-4"},K=t("div",{class:"font-bold text-xl"},"Transacciones",-1),R={key:0,class:"text-center text-gray-400"},U={class:"text-gray-400 text-xs mb-2"},H={class:"mb-1"},J={class:"flex justify-between items-end"},Q={key:0},W={class:"text-gray-400 text-sm"},X={class:"text-xl"},Z={class:"flex flex-col gap-4"},tt=t("div",{class:"font-bold text-xl"},"Resumen",-1),et=t("th",null,"Tipo",-1),at=t("th",null,"Cantidad",-1),st=t("th",null,"Peso",-1),ot=t("th",null,"Total",-1),nt={key:0},lt=t("td",{colspan:"6",class:"text-center"},"No hay datos que mostrar",-1),rt=[lt],ct=t("th",null,"Banco",-1),ut=t("th",null,"Cantidad",-1),dt=t("th",null,"Total",-1),it={key:0},_t=t("td",{colspan:"6",class:"text-center"},"No hay datos que mostrar",-1),ht=[_t],mt={class:"flex justify-end gap-4"},kt=D({__name:"ArchingCreate",setup(yt){const{getBillingDay:T,queryParams:m,billing:u}=P(),{processing:M,storeArching:B}=L(),y=b([]),v=b([]),i=b({date:"",total:0,summary:[],accountSummary:[],billing_ids:[]});$(()=>m.value.date,async()=>{await T(),w(),S()}),j(async()=>{m.value.date=q(new Date,"YYYY-MM-DD"),await T(),w(),S()});function w(){const d=new Set(u.value.data.map(e=>e.account_key)),s=[];d.forEach(e=>{const a=u.value.data.filter(c=>c.account_key===e);s.push({account_key:e,total:Math.round(a.reduce((c,r)=>c+r.total,0)*100)/100,references:a.map(c=>c.reference)})}),s.push({account_key:"TOTAL",total:Math.round(s.reduce((e,a)=>e+a.total,0)*100)/100,references:u.value.data.map(e=>e.reference)}),y.value=s}function S(){const d=u.value.data.filter(a=>a.summary!==void 0&&a.summary.length>1).map(a=>a.summary).flat(),s=[];[...new Set(d.map(a=>a.type))].sort().forEach(a=>{const c=d.filter(r=>r&&r.type===a);s.push({type:a,weight:Math.round(c.reduce((r,f)=>r+f.weight,0)*100)/100,amount:Math.round(c.reduce((r,f)=>r+f.amount,0)*100)/100,count:Math.round(c.reduce((r,f)=>r+f.count,0))})}),v.value=s}function V(){u.value.data.length||A.error("No hay transacciones que guardar"),i.value.date=m.value.date,i.value.summary=v.value,i.value.accountSummary=y.value,i.value.billing_ids=u.value.data.map(s=>s.id);const d=y.value.find(s=>s.account_key==="TOTAL");d&&(i.value.total=d.total),i.value.total<1&&A.error("El total es requerido"),B(i.value)}return(d,s)=>(l(),n(x,null,[O,t("div",z,[g(Y,{text:"Fecha",name:"date",modelValue:_(m).date,"onUpdate:modelValue":s[0]||(s[0]=e=>_(m).date=e),type:"date"},null,8,["modelValue"])]),t("div",G,[t("div",I,[K,_(u).data.length?p("",!0):(l(),n("div",R,"No hay transacciones")),(l(!0),n(x,null,k(_(u).data,e=>(l(),n("div",{key:e.id,class:"bg-white p-4 rounded-lg border"},[t("div",U,o(_(q)(e.createdAt)),1),t("div",H,o(e.client),1),t("div",J,[t("div",null,[e.account&&typeof e.account!="string"?(l(),n("span",Q,o(e.account.type)+": "+o(e.account.number),1)):p("",!0),t("div",W,o(e.reference),1)]),t("div",X,"$"+o(e.total),1)])]))),128))]),t("div",Z,[tt,g(N,null,{header:h(()=>[et,at,st,ot]),body:h(()=>[v.value.length?p("",!0):(l(),n("tr",nt,rt)),(l(!0),n(x,null,k(v.value,(e,a)=>(l(),n("tr",{key:a,class:"hover:bg-gray-50"},[t("td",null,o(e.type),1),t("td",null,o(e.count),1),t("td",null,o(e.weight)+" lbs",1),t("td",null,"$"+o(e.amount),1)]))),128))]),_:1}),g(N,null,{header:h(()=>[ct,ut,dt]),body:h(()=>[y.value.length?p("",!0):(l(),n("tr",it,ht)),(l(!0),n(x,null,k(y.value,(e,a)=>(l(),n("tr",{key:a,class:"hover:bg-gray-50"},[t("td",null,o(e.account_key),1),t("td",null,o(e.references.length),1),t("td",null,"$"+o(e.total),1)]))),128))]),_:1}),t("div",mt,[g(E,null,{default:h(()=>[C("Cancelar")]),_:1}),g(F,{onClick:V,loading:_(M)},{default:h(()=>[C(" Guardar ")]),_:1},8,["loading"])])])])],64))}});export{kt as default};
