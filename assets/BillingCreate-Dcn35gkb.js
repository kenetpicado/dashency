import{A as te,b as ae,r as h,D as le,o as oe,w as se,K as B,e as s,m as u,f as c,L as ne,i as l,F as f,g as _,n as b,T as ue,G as re,p as de,t as g,q as ie,x as ce,k as o,M as me,l as S,h as ve,v as O,z as M}from"./index-DoD9Z4gP.js";import{_ as m}from"./InputForm.vue_vue_type_script_setup_true_lang-BoxpC0zP.js";import{L as pe}from"./index-BAXTtRna.js";/* empty css              */import{u as ge,_ as L}from"./usePackage-C93RcL5h.js";import{u as he}from"./useBilling-ejc6_fVn.js";import{u as fe}from"./usePrice-DP-vEKvH.js";import{u as ye}from"./useAccount-BYbPGXBO.js";import"./query-params-C5SC1Cld.js";/**
 * @license @tabler/icons-vue v3.12.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var _e=te("outline","trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]);const be=l("header",{class:"flex items-center justify-between mb-4 h-14"},[l("span",{class:"font-bold text-2xl"},"Nueva")],-1),xe={class:"grid grid-cols-2 gap-4"},Ve=l("div",{class:"text-lg mb-2 font-bold"},"Buscar paquetes",-1),ke={class:"grid grid-cols-2 gap-4 mb-4"},Pe={key:0,class:"w-full flex justify-center mb-4"},Te={key:1,class:"text-center text-gray-400"},Me={key:2,class:"grid grid-cols-1 xl:grid-cols-2 gap-4"},qe=l("div",{class:"text-lg mb-2 font-bold"},"Datos de la factura",-1),we={key:0,class:"text-center text-gray-400 mb-8"},Se={key:1,class:"grid grid-cols-1 xl:grid-cols-2 gap-4 mb-8"},Ie=l("th",null,"Envío",-1),Ne=l("th",null,"Peso",-1),Ce=l("th",null,"Paquetes",-1),Ue=l("th",null,"Total a pagar",-1),De={key:0},Ae=l("td",{colspan:"5",class:"text-center"},"No hay datos que mostrar",-1),$e=[Ae],Be={class:"font-bold"},Oe={class:"bg-edo-50 px-2 py-1 rounded-lg"},Le={class:"mb-4"},Re=l("h4",{class:"text-xl mb-2 font-bold text-gray-400"},"Precios por libra",-1),Ee=l("hr",{class:"mb-4"},null,-1),Ge={class:"grid grid-cols-2 gap-4"},We=l("h4",{class:"text-xl mb-2 font-bold text-gray-400"},"Información del pedido",-1),je=l("hr",{class:"mb-4"},null,-1),Fe={class:"grid grid-cols-2 gap-4"},ze=l("option",{value:""},"Seleccionar cuenta",-1),Ke=["value"],He=l("div",{class:"text-sm text-gray-400 mb-4"}," Por favor, verifique los datos antes de guardar la factura ya que no se podrán modificar posteriormente. ",-1),Je={key:0,class:"bg-red-100 p-4 rounded-lg text-red-600"},Qe={key:1,class:"flex justify-end gap-4"},ut=ae({__name:"BillingCreate",setup(Xe){const r=h([]),{getPackages:R,packages:I,queryParams:p,processing:N}=ge(),{storeBilling:E,processing:x}=he(),{prices:G,getPrices:W}=fe(),{accounts:j,getAccounts:F,queryParams:z}=ye(),V=h([]),k=h(""),P=h([]),t=h({client:"",packages_ids:[],total:0,reference:"",account:"",summary:[],subTotal:0,delivery:0,fee:0,address:"",notes:""});function K(n){r.value.push(n),r.value.length===1&&(t.value.client=n.client),q()}function H(n){r.value.splice(n,1),r.value.length||(t.value.client=""),q()}const C=le(()=>I.value.data.filter(n=>!r.value.find(a=>a.id===n.id)));function J(){if(!t.value.client){M.error("Debe ingresar el nombre del cliente");return}if(!r.value.length){M.error("Debe seleccionar al menos un paquete");return}if(!t.value.reference){M.error("Ingrese una referencia");return}if(!t.value.account){M.error("Seleccione una cuenta");return}t.value.summary=V.value,t.value.packages_ids=r.value.map(n=>n.id),E(t.value)}function q(){var U,D;k.value="";const n=new Set(r.value.map(i=>i.type)),a=h([]);n.forEach(i=>{var $;const v=(($=P.value.find(y=>y.type===i))==null?void 0:$.value)||0;if(!v){k.value=`No se encontró un precio para el tipo de envío ${i}, por favor registre uno`;return}const A=r.value.filter(y=>y.type===i),Q=A.reduce((y,ee)=>y+ee.grossWeight,0),w=Math.round(Q*100)/100,X=w<1?v:v*w,Y=Math.round(X*100)/100,Z={type:i,weight:w,count:A.length,price:v,amount:Y};a.value.push(Z)});const e=a.value.reduce((i,v)=>i+v.weight,0),d=a.value.reduce((i,v)=>i+v.amount,0),T={type:"TOTAL",weight:Math.round(e*100)/100,count:r.value.length,amount:Math.round(d*100)/100};a.value.push(T),t.value.subTotal=T.amount,t.value.total=T.amount+(((U=t.value)==null?void 0:U.delivery)??0)+(((D=t.value)==null?void 0:D.fee)??0),t.value.total=Math.round(t.value.total*100)/100,V.value=a.value}return oe(async()=>{N.value=!0,I.value.data=[],p.value.status="REGISTRADO",z.value.status="ACTIVO",await W(),F(),P.value=G.value}),se(p.value,()=>{p.value.status="REGISTRADO",R()},{debounce:500,maxWait:1e3}),B(()=>[t.value.delivery,t.value.fee],()=>{var n,a;t.value.total=t.value.subTotal+(((n=t.value)==null?void 0:n.delivery)??0)+(((a=t.value)==null?void 0:a.fee)??0)}),B(()=>P.value,()=>{q()},{deep:!0}),(n,a)=>(o(),s(f,null,[u(c(pe),{active:c(x),"onUpdate:active":a[0]||(a[0]=e=>ne(x)?x.value=e:null),color:"#2563eb",loader:"dots"},null,8,["active"]),be,l("div",xe,[l("div",null,[Ve,l("div",ke,[u(m,{text:"Cliente",name:"search",type:"search",modelValue:c(p).client,"onUpdate:modelValue":a[1]||(a[1]=e=>c(p).client=e),placeholder:"Nombre del cliente"},null,8,["modelValue"]),u(m,{text:"Guía",name:"search",type:"search",modelValue:c(p).guide,"onUpdate:modelValue":a[2]||(a[2]=e=>c(p).guide=e),placeholder:"Número de guía"},null,8,["modelValue"])]),c(N)?(o(),s("div",Pe,[u(me,{class:"text-edo-400"})])):C.value.length?(o(),s("div",Me,[(o(!0),s(f,null,_(C.value,(e,d)=>(o(),S(L,{item:e,key:d,showIcon:!0,onSelectedItem:K},null,8,["item"]))),128))])):(o(),s("div",Te," No hay datos que mostrar "))]),l("div",null,[qe,r.value.length?(o(),s("div",Se,[(o(!0),s(f,null,_(r.value,(e,d)=>(o(),S(L,{item:e,key:d,showIcon:!0,icon:c(_e),onSelectedItem:T=>H(d)},null,8,["item","icon","onSelectedItem"]))),128))])):(o(),s("div",we," No hay paquetes seleccionados ")),u(ue,{class:"mb-4"},{header:b(()=>[Ie,Ne,Ce,Ue]),body:b(()=>[V.value.length==0?(o(),s("tr",De,$e)):ve("",!0),(o(!0),s(f,null,_(V.value,(e,d)=>(o(),s("tr",{key:d},[l("td",null,g(e.type),1),l("td",null,g(e.weight)+" lbs",1),l("td",null,g(e.count),1),l("td",Be,[l("span",Oe," $"+g(e.amount),1)])]))),128))]),_:1}),l("div",Le,[Re,Ee,l("div",Ge,[(o(!0),s(f,null,_(P.value,e=>(o(),S(m,{key:e.id,text:e.type,name:e.type,modelValue:e.value,"onUpdate:modelValue":d=>e.value=d,modelModifiers:{number:!0},placeholder:"Precio",type:"number"},null,8,["text","name","modelValue","onUpdate:modelValue"]))),128))])]),l("form",{onSubmit:a[10]||(a[10]=re(e=>J(),["prevent"]))},[We,je,l("div",Fe,[u(m,{text:"Cliente",name:"client",modelValue:t.value.client,"onUpdate:modelValue":a[3]||(a[3]=e=>t.value.client=e),placeholder:"Nombre del cliente",required:""},null,8,["modelValue"]),u(m,{text:"Notas (Opcional)",name:"notes",modelValue:t.value.notes,"onUpdate:modelValue":a[4]||(a[4]=e=>t.value.notes=e),placeholder:"Notas"},null,8,["modelValue"]),u(de,{text:"Cuenta",name:"account",modelValue:t.value.account,"onUpdate:modelValue":a[5]||(a[5]=e=>t.value.account=e),required:""},{default:b(()=>[ze,(o(!0),s(f,null,_(c(j),e=>(o(),s("option",{value:e.id,key:e.id},g(e.type)+" - "+g(e.number),9,Ke))),128))]),_:1},8,["modelValue"]),u(m,{text:"Referencia",name:"reference",type:"number",modelValue:t.value.reference,"onUpdate:modelValue":a[6]||(a[6]=e=>t.value.reference=e),placeholder:"Código o referencia",required:""},null,8,["modelValue"]),u(m,{text:"Costo envío terrestre (Opcional)",name:"delivery",modelValue:t.value.delivery,"onUpdate:modelValue":a[7]||(a[7]=e=>t.value.delivery=e),modelModifiers:{number:!0},placeholder:"Costo del delivery",type:"number"},null,8,["modelValue"]),u(m,{text:"Dirección de entrega (Opcional)",name:"address",modelValue:t.value.address,"onUpdate:modelValue":a[8]||(a[8]=e=>t.value.address=e),placeholder:"Direccion de entrega"},null,8,["modelValue"]),u(m,{text:"Importe extra (Opcional)",name:"fee",modelValue:t.value.fee,"onUpdate:modelValue":a[9]||(a[9]=e=>t.value.fee=e),modelModifiers:{number:!0},placeholder:"Importe extra",type:"number"},null,8,["modelValue"])]),He,k.value?(o(),s("div",Je,g(k.value),1)):(o(),s("div",Qe,[u(ie,null,{default:b(()=>[O("Cancelar")]),_:1}),u(ce,{type:"submit",loading:c(x)},{default:b(()=>[O(" Guardar ")]),_:1},8,["loading"])]))],32)])])],64))}});export{ut as default};
